<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Motivational Reel Generator</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; margin: 50px auto; 
            padding: 20px; 
            background: #f5f5f5; 
            display: flex; 
            flex-direction: column; 
            box-sizing: border-box; 
        }
        h1 { font-size: 1.5em; text-align: center; margin-bottom: 10px; }
        p { font-size: 0.9em; text-align: center; margin-bottom: 20px; }
        input, button { 
            padding: 15px; 
            margin: 10px 0; 
            font-size: 1em; 
            border: 1px solid #ccc; 
            border-radius: 5px; 
            width: 100%; 
            box-sizing: border-box; 
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            font-weight: bold; 
            cursor: pointer; 
            touch-action: manipulation; 
        }
        button:disabled { background: #ccc; }
        #status { 
            margin: 20px 0; 
            padding: 15px; 
            background: #e9ecef; 
            border-radius: 5px; 
            font-size: 0.9em; 
            text-align: center; 
            min-height: 20px; 
        }
        #download { 
            display: none; 
            margin-top: 20px; 
            padding: 15px; 
            background: #28a745; 
            color: white; 
            text-align: center; 
            border-radius: 5px; 
            text-decoration: none; 
            font-weight: bold; 
        }
        @media (max-width: 480px) { 
            body { padding: 10px; margin: 10px; } 
            h1 { font-size: 1.2em; } 
            input, button { padding: 12px; } 
        }
    </style>
</head>
<body>
    <h1>ðŸ”¥ Bold Motivational Reel Generator</h1>
    <p>Enter Pexels API key & keyword. Creates 15s vertical reel with zoom effect + upbeat music. Ready for text overlays!</p>
    
    <input type="text" id="apiKey" placeholder="Pexels API Key (from pexels.com/api)" required>
    <input type="text" id="keyword" placeholder="e.g., bold gym motivation" value="bold motivation sunrise" required>
    <button onclick="generateReel()">Generate Reel</button>
    
    <div id="status">Readyâ€”enter details above!</div>
    <a id="download" download="motivational-reel.mp4">ðŸ“¥ Download Reel MP4</a>

    <script type="module">
        import { FFmpeg } from 'https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/umd/ffmpeg.js';
        import { fetchFile, toBlobURL } from 'https://unpkg.com/@ffmpeg/util@0.12.1/dist/umd/index.js';

        let ffmpeg;

        async function loadFFmpeg() {
            if (!ffmpeg) {
                ffmpeg = new FFmpeg();
                const baseURL = 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd';
                await ffmpeg.load({
                    coreURL: await toBlobURL(`${baseURL}/ffmpeg-core.js`, 'text/javascript'),
                    wasmURL: await toBlobURL(`${baseURL}/ffmpeg-core.wasm`, 'application/wasm'),
                });
            }
            return ffmpeg;
        }

        window.generateReel = async function() {
            const apiKey = document.getElementById('apiKey').value;
            const keyword = document.getElementById('keyword').value;
            const status = document.getElementById('status');
            const downloadLink = document.getElementById('download');
            
            if (!apiKey || !keyword) return alert('Enter API key and keyword!');
            
            status.innerHTML = 'Loading tools... (first time takes ~30s)';
            downloadLink.style.display = 'none';
            document.querySelector('button').disabled = true;
            
            try {
                const ff = await loadFFmpeg();
                status.innerHTML = 'Fetching video from Pexels...';
                
                const response = await fetch(`https://api.pexels.com/v1/videos/search?query=${encodeURIComponent(keyword)}&per_page=1`, {
                    headers: { Authorization: apiKey }
                });
                const data = await response.json();
                if (!data.videos || data.videos.length === 0) throw new Error('No videos found. Try a simpler keyword like "motivation".');
                const videoUrl = data.videos[0].video_files[0].link;
                
                const musicUrl = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3'; // Free royalty-free upbeat loop
                
                status.innerHTML = 'Downloading video & music...';
                
                await ff.writeFile('input.mp4', await fetchFile(videoUrl));
                await ff.writeFile('music.mp3', await fetchFile(musicUrl));
                
                status.innerHTML = 'Applying bold zoom effect & music overlay... (15s reel)';
                
                // Optimized for PC/office: 15s, fast encode, subtle zoom
                await ff.exec([
                    '-i', 'input.mp4',
                    '-i', 'music.mp3',
                    '-t', '15',
                    '-vf', 'scale=1080:1920:force_original_aspect_ratio=decrease,pad=1080:1920:(ow-iw)/2:(oh-ih)/2,zoompan=z=\'min(zoom+0.001,1.3)\':d=375:s=1080x1920:fps=24',
                    '-af', 'volume=0.6',
                    '-c:v', 'libx264',
                    '-preset', 'ultrafast',
                    '-c:a', 'aac',
                    '-shortest',
                    'output.mp4'
                ]);
                
                status.innerHTML = 'Encoding doneâ€”preparing download!';
                
                const data = await ff.readFile('output.mp4');
                const blob = new Blob([data.buffer], { type: 'video/mp4' });
                const url = URL.createObjectURL(blob);
                downloadLink.href = url;
                downloadLink.style.display = 'block';
                status.innerHTML = 'Success! Click download to save your reel.';
                
            } catch (error) {
                status.innerHTML = `Error: ${error.message}. Check internet/API key or try again. (Console: F12)`;
                console.error(error);
            } finally {
                document.querySelector('button').disabled = false;
            }
        };
    </script>
</body>
</html>
